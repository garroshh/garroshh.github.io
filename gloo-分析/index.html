<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Gloo 分析 - LoveIt</title><meta name=Description content="关于 LoveIt 主题"><meta property="og:title" content="Gloo 分析"><meta property="og:description" content="以下为个人理解，仅供参考！ Gloo Envoy Upgrades As we ship an extended version of Envoy, it is very important for us to stay close to upstream Envoy. To achieve this, our repository structure and CI closely resembles those of Envoy. Envoy master branch is always considered RC quality. We therefore make sure frequently that Gloo can be built with the latest"><meta property="og:type" content="article"><meta property="og:url" content="https://garroshh.me/gloo-%E5%88%86%E6%9E%90/"><meta property="og:image" content="https://garroshh.me/logo.png"><meta property="article:published_time" content="2020-05-14T15:21:56+08:00"><meta property="article:modified_time" content="2020-05-14T15:21:56+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://garroshh.me/logo.png"><meta name=twitter:title content="Gloo 分析"><meta name=twitter:description content="以下为个人理解，仅供参考！ Gloo Envoy Upgrades As we ship an extended version of Envoy, it is very important for us to stay close to upstream Envoy. To achieve this, our repository structure and CI closely resembles those of Envoy. Envoy master branch is always considered RC quality. We therefore make sure frequently that Gloo can be built with the latest"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://garroshh.me/gloo-%E5%88%86%E6%9E%90/><link rel=prev href=https://garroshh.me/gloo-routing/><link rel=next href=https://garroshh.me/gloo-gloo-%E7%AE%80%E4%BB%8B%E5%8A%9F%E8%83%BD%E5%92%8C%E6%9E%B6%E6%9E%84/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Gloo 分析","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/garroshh.me\/gloo-%E5%88%86%E6%9E%90\/"},"image":{"@type":"ImageObject","url":"https:\/\/garroshh.me\/cover.png","width":800,"height":600},"genre":"posts","keywords":"Gloo, 原理","wordcount":507,"url":"https:\/\/garroshh.me\/gloo-%E5%88%86%E6%9E%90\/","datePublished":"2020-05-14T15:21:56+08:00","dateModified":"2020-05-14T15:21:56+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"https:\/\/garroshh.me\/logo.png","width":127,"height":40}},"author":{"@type":"Person","name":"garroshh"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=LoveIt><span class=header-title-pre><i class="far fa-kiss-wink-heart fa-fw"></i></span><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/categories/documentation/>文档 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/dillonzq/LoveIt title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value;"><option value=/gloo-%E5%88%86%E6%9E%90/ selected>简体中文</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=LoveIt><span class=header-title-pre><i class="far fa-kiss-wink-heart fa-fw"></i></span><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/>所有文章</a><a class=menu-item href=/tags/>标签</a><a class=menu-item href=/categories/>分类</a><a class=menu-item href=/categories/documentation/>文档</a><a class=menu-item href=/about/>关于</a><a class=menu-item href=https://github.com/dillonzq/LoveIt title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a><a href=javascript:void(0); class=menu-item title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value;"><option value=/gloo-%E5%88%86%E6%9E%90/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Gloo 分析</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=garroshh.me title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>garroshh</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/gloo/><i class="far fa-folder fa-fw"></i>Gloo</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-05-14>2020-05-14</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 507 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 2 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents></nav></div></div><div class=content id=content><p>以下为个人理解，仅供参考！</p><h1 id=gloo-envoy-upgrades>Gloo Envoy Upgrades</h1><p>As we ship an extended version of Envoy, it is very important for us to stay close to upstream Envoy. To achieve this, our repository structure and CI closely resembles those of Envoy.</p><p>Envoy master branch is always considered RC quality. We therefore make sure frequently that Gloo can be built with the latest master code. This ensures that we always have the latest Envoy features and optimizations, and can respond quickly if a security update is needed. Building Envoy on the 32-core CI we use takes about 10 minutes.</p><p><img class=lazyload src=/svg/loading/small.min.svg data-src=https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152256884.png data-srcset="https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152256884.png, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152256884.png 1.5x, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152256884.png 2x" data-sizes=auto alt=image-20200514152256884 title=image-20200514152256884></p><p><img class=lazyload src=/svg/loading/small.min.svg data-src=https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152319241.png data-srcset="https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152319241.png, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152319241.png 1.5x, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152319241.png 2x" data-sizes=auto alt=image-20200514152319241 title=image-20200514152319241></p><h1 id=servless-支持>servless 支持</h1><p><img class=lazyload src=/svg/loading/small.min.svg data-src=https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152341972.png data-srcset="https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152341972.png, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152341972.png 1.5x, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152341972.png 2x" data-sizes=auto alt=image-20200514152341972 title=image-20200514152341972></p><p>In order to achieve Knative scale-from-zero, we use a Mixer <a href=https://github.com/istio/istio/wiki/Mixer-Out-Of-Process-Adapter-Dev-Guide target=_blank rel="noopener noreffer">out-of-process adapter</a> to call the Autoscaler. Out-of-process adapters for Mixer allow developers to use any programming language and to build and maintain your extension as a stand-alone program without the need to build the Istio proxy. 好复杂的感觉。</p><p><img class=lazyload src=/svg/loading/small.min.svg data-src=https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152402705.png data-srcset="https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152402705.png, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152402705.png 1.5x, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152402705.png 2x" data-sizes=auto alt=image-20200514152402705 title=image-20200514152402705></p><p>只需创建一个 Aws 类型的 Upstream，so easy 的感觉。</p><h1 id=api-组合>Api 组合</h1><p>Sqoop (formerly QLoo) is a GraphQL Server built on top of Gloo and the Envoy Proxy.</p><p>Sqoop leverages Gloo&rsquo;s function registry and Envoy&rsquo;s advanced HTTP routing features to provide a GraphQL frontend for REST/gRPC applications and serverless functions. Sqoop routes requests to data sources via Envoy, leveraging Envoy HTTP filters for security, load balancing, and more.</p><p><img class=lazyload src=/svg/loading/small.min.svg data-src=https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152428303.png data-srcset="https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152428303.png, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152428303.png 1.5x, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152428303.png 2x" data-sizes=auto alt=image-20200514152428303 title=image-20200514152428303></p><p>个人觉得基于此可做Api组合的事情，一方面项目大起来之后，减少聚合层做的工作，另一方面，减少后端接口的数量。</p><p>Istio 暂无，也不会有，关注点不一样，是东西流量。</p><h1 id=灰度发布>灰度发布</h1><p>Istio 做法：哪一个服务要灰度，写哪一个服务的 VirtualService，个人觉得，灰度的配置管理，当前和流控，路由等的配置都集中在了目的服务的vs配置里，不便于管理。另一方面，服务多了之后，因为是为目标服务来做配置，这些配置文件如何管理。如下的这些灰度规则，个人</p><p>觉得都有点晕了。</p><p><img class=lazyload src=/svg/loading/small.min.svg data-src=https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152442003.png data-srcset="https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152442003.png, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152442003.png 1.5x, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152442003.png 2x" data-sizes=auto alt=image-20200514152442003 title=image-20200514152442003></p><p><img class=lazyload src=/svg/loading/small.min.svg data-src=https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152459187.png data-srcset="https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152459187.png, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152459187.png 1.5x, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152459187.png 2x" data-sizes=auto alt=image-20200514152459187 title=image-20200514152459187></p><p>Gloo 做法, 通过Upstream Group 统一起来，So Easy，至少视觉效果是这样</p><p><img class=lazyload src=/svg/loading/small.min.svg data-src=https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152519259.png data-srcset="https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152519259.png, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152519259.png 1.5x, https://cdn.jsdelivr.net/gh/garroshh/figurebed/2020/image-20200514152519259.png 2x" data-sizes=auto alt=image-20200514152519259 title=image-20200514152519259></p><p>参考：</p><p><a href=https://medium.com/solo-io/building-a-control-plane-for-envoy-7524ceb09876>https://medium.com/solo-io/building-a-control-plane-for-envoy-7524ceb09876</a></p><p><a href=https://github.com/solo-io/sqoop>https://github.com/solo-io/sqoop</a></p><p><a href=https://istio.io/blog/2019/knative-activator-adapter/>https://istio.io/blog/2019/knative-activator-adapter/</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2020-05-14</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/gloo/>Gloo</a>,&nbsp;<a href=/tags/%E5%8E%9F%E7%90%86/>原理</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/gloo-routing/ class=prev rel=prev title="Gloo Routing"><i class="fas fa-angle-left fa-fw"></i>Gloo Routing</a>
<a href=/gloo-gloo-%E7%AE%80%E4%BB%8B%E5%8A%9F%E8%83%BD%E5%92%8C%E6%9E%B6%E6%9E%84/ class=next rel=next title="Gloo Gloo 简介、功能和架构">Gloo Gloo 简介、功能和架构<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=gitalk class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://github.com/gitalk/gitalk></a>Gitalk</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.71.1">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.9"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=garroshh.me target=_blank>garroshh</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.0/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"gitalk":{"admin":["garroshh"],"clientID":"765aeb40ecd9058c4ab8","clientSecret":"824af1ecb35c665e4d7fb379211bb748841e96a1","id":"2020-05-14T15:21:56+08:00","owner":"garroshh","repo":"garroshh.github.io","title":"Gloo 分析"}},"data":{"id-1":"Garroshh's Blog","id-2":"Garroshh's Blog"},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.zh-cn","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>